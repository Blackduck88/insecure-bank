trigger:
- master

pool:
  name: MyAgentPool
  demands:
   - agent.name -equals nuc

variables:
- name: COVERITY_TOOL_HOME
  value: /home/siguser/cov-analysis-linux64-2021.03
steps:
- task: synopsys-coverity@1
  inputs:
    coverityService: 'Coverity'
    projectName: 'Insecure-Bank'
    streamName: 'insecure-bank'
    checkIssues: true
    issueView: 'build-breakers'
    issueStatus: 'failure'
    coverityBuildDirectory: '$(Build.Repository.LocalPath)'
    coverityAnalysisType: 'incremental'
    buildCommand: 'mvn clean install -DskipTests'
- task: SynopsysDetectTask@6
  inputs:
    BlackDuckService: 'Testing.BlackDuck'
    DetectVersion: 'latest'
    DetectArguments: '--detect.project.name=MJ-insecure-bank'
- task: synopsys-coverity@1
  inputs:
    coverityService: 'Coverity'
    projectName: 'Insecure-Bank'
    streamName: 'insecure-bank'
    checkIssues: true
    issueView: 'build-breakers'
    issueStatus: 'failure'
    coverityBuildDirectory: '$(Build.Repository.LocalPath)'
    buildCommand: 'mvn clean install -DskipTests'
- task: SynopsysPolaris@1
  inputs:
    polarisService: 'SIPSE.polaris.synopsys.com'
    polarisCommand: 'analyze'
    waitForIssues: true

- task: CmdLine@2
  displayName: 'Coverity Capture'
  inputs:
    script: 'coverity capture'

- task: CmdLine@2
  displayName: 'Coverity Analysis'
  inputs:
    script: 'coverity analyze'


